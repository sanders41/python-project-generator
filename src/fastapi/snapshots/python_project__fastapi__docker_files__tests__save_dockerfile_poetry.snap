---
source: src/fastapi/docker_files.rs
expression: content
---
"# syntax=docker/dockerfile:1\n\nFROM ubuntu:24.04 AS builder\n\nWORKDIR /app\n\nENV \\\n  PYTHONUNBUFFERED=true \\\n  POETRY_NO_INTERACTION=true \\\n  POETRY_VIRTUALENVS_IN_PROJECT=true \\\n  POETRY_CACHE_DIR=/tmp/poetry_cache\n\nRUN : \\\n  && apt-get update \\\n  && apt-get install -y --no-install-recommends \\\n  build-essential \\\n  curl \\\n  ca-certificates \\\n  software-properties-common \\\n  && add-apt-repository ppa:deadsnakes/ppa \\\n  && apt-get update \\\n  && apt-get install -y --no-install-recommends \\\n  python3.11 \\\n  && apt-get clean \\\n  && rm -rf /var/lib/apt/lists/*\n\n# Install Poetry\nRUN curl -sSL https://install.python-poetry.org | python3.11 -\n\nENV PATH=\"/root/.local/bin:$PATH\"\n\nCOPY pyproject.toml poetry.lock ./\n\nCOPY . ./\n\nRUN --mount=type=cache,target=$POETRY_CACHE_DIR \\\n  poetry config virtualenvs.in-project true \\\n  && poetry install --only=main\n\n\n# Build production stage\nFROM ubuntu:24.04 AS prod\n\nRUN useradd appuser\n\nWORKDIR /app\n\nRUN chown appuser:appuser /app\n\nENV \\\n  PYTHONUNBUFFERED=true \\\n  PATH=\"/app/.venv/bin:$PATH\" \\\n  PORT=\"8000\"\n\nRUN : \\\n  && apt-get update \\\n  && apt-get install -y --no-install-recommends\\\n  software-properties-common \\\n  && add-apt-repository ppa:deadsnakes/ppa \\\n  && apt-get update \\\n  && apt-get install -y --no-install-recommends python3.11 \\\n  && apt-get clean \\\n  && rm -rf /var/lib/apt/lists/*\n\nCOPY --from=builder /app/.venv /app/.venv\nCOPY --from=builder /app/my_project /app/my_project\nCOPY ./scripts/entrypoint.sh /app\n\nRUN chmod +x /app/entrypoint.sh\n\nEXPOSE 8000\n\nUSER appuser\n\nENTRYPOINT [\"./entrypoint.sh\"]\n"
